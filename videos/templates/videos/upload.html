{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Panel de Mercadotecnia</title>
    <link rel="stylesheet" href="{% static 'videos/css/upload.css' %}">
</head>

<body>
    <header>
        Panel de Mercadotecnia ADICLA
    </header>

    <main>
        <h1>Subir Video</h1>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary">Subir</button>
        </form>

        <h2>Videos Subidos</h2>
        <ul>
            {% for video in videos %}
            <li>
                <span>{{ video.title }}</span>
                <span>{{ video.uploaded_at|date:"d M Y H:i" }}</span>
                <div class="actions">
                    <a href="{% url 'edit_video' video.id %}" class="btn btn-edit">Editar</a>
                    <button type="button" class="btn btn-delete" data-video-id="{{ video.id }}"
                        data-video-title="{{ video.title }}">Eliminar</button>
                </div>
            </li>
            {% empty %}
            <li>No hay videos</li>
            {% endfor %}
        </ul>
    </main>

    <!-- Modal de confirmación -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h2>Confirmar eliminación</h2>
            <p id="modal-text"></p>
            <div class="modal-actions">
                <form id="deleteForm" method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-delete">Sí, eliminar</button>
                </form>
                <button type="button" class="btn btn-cancel" id="cancelDelete">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const modal = document.getElementById("confirmModal");
            const modalText = document.getElementById("modal-text");
            const cancelBtn = document.getElementById("cancelDelete");
            const deleteForm = document.getElementById("deleteForm");

            // Asignar evento a todos los botones de eliminar
            const deleteButtons = document.querySelectorAll(".btn-delete[data-video-id]");
            deleteButtons.forEach(btn => {
                btn.addEventListener("click", function () {
                    const videoId = this.dataset.videoId;
                    const videoTitle = this.dataset.videoTitle;

                    // Mostrar texto en modal
                    modalText.textContent = `¿Realmente deseas eliminar el video "${videoTitle}"? Esta acción no se puede deshacer.`;

                    // Cambiar action del formulario al video correspondiente
                    deleteForm.action = `/delete/${videoId}/`;

                    // Mostrar modal
                    modal.style.display = "flex";
                });
            });

            // Cancelar eliminación
            cancelBtn.addEventListener("click", function () {
                modal.style.display = "none";
            });
        });
    </script>

    <!-- FOOTER -->
    <footer>
        <p>© 2025 Sitio Web ADICLA Mercadotecnia y Publicidad. Todos los derechos reservados.</p>
    </footer>
</body>

</html>